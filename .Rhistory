modules[[2]]
modules[[3]]
modules[[4]]
modules[[5]]
modules[[6]]
modules[[7]]
?torch_flatten
modules[[7]](head(dl)$input)
dim(modules[[7]](head(dl)$input))
dim(head(dl)$input)
load_all()
scorch_model = dl |>
initiate_scorch() |>
scorch_layer(nn_conv2d(1,32,3,1)) |>
scorch_layer(nn_relu())|>
scorch_layer(nn_conv2d(32,64,3,1)) |>
scorch_layer(nn_relu()) |>
scorch_layer(nn_max_pool2d(2)) |>
scorch_layer(nn_dropout2d(0.25)) |>
scorch_function(torch_flatten,start_dim=2) |>
scorch_layer(nn_linear(9216,128))
load_all()
scorch_model = dl |>
initiate_scorch() |>
scorch_layer(nn_conv2d(1,32,3,1)) |>
scorch_layer(nn_relu())|>
scorch_layer(nn_conv2d(32,64,3,1)) |>
scorch_layer(nn_relu()) |>
scorch_layer(nn_max_pool2d(2)) |>
scorch_layer(nn_dropout2d(0.25)) |>
scorch_function(torch_flatten,start_dim=2) |>
scorch_layer(nn_linear(9216,128))
scorch_model
scorch_model$dl$scorch_architecture[[1]]
scorch_model$dl$scorch_architecture[[2]]
scorch_model$dl$scorch_architecture[[3]]
scorch_model$dl$scorch_architecture[[5]]
scorch_model$dl$scorch_architecture[[6]]
scorch_model$dl$scorch_architecture[[8]]
scorch_model$dl$scorch_architecture[[8]]$type
scorch_model$scorch_architecture[[1]]
scorch_model$scorch_architecture[[2]]
scorch_model$scorch_architecture[[3]]
scorch_model$scorch_architecture[[4]]
scorch_model$scorch_architecture[[12]]
scorch_model$scorch_architecture[[16]]
scorch_model$scorch_architecture[[20]]
scorch_model$scorch_architecture[[c(2,4,6)]]
scorch_model$scorch_architecture[[2]]
scorch_model$scorch_architecture[[4]]
scorch_model$scorch_architecture[[c(2,4)]]
scorch_model
c(scorch_model, list(nn="test",type="layer"))
length(c(scorch_model, list(nn="test",type="layer")))
length(scorch_model)
scorch_model[[1]]
names(scorch_model)
scorch_model$scorch_architecture
length(scorch_model$scorch_architecture)
length(append(scorch_model$scorch_architecture, list(nn="test",type="layer")))
append(scorch_model$scorch_architecture, list(nn="test",type="layer"))
`$`(scorch_model$scorch_architecture, type)
(scorch_model$scorch_architecture[["type"]]
scorch_model$scorch_architecture[["type"]]
scorch_model$scorch_architecture[[c(1,2)]]
scorch_model$scorch_architecture[[c(1,1)]]
scorch_model$scorch_architecture[c(1,2)]
scorch_model$scorch_architecture[c(2,4,6,8)]
scorch_model$scorch_architecture[c(2,4,6,8)] |> as.vector()
scorch_model$scorch_architecture[c(2,4,6,8)] |> unlist9
scorch_model$scorch_architecture[c(2,4,6,8)] |> unlist()
sm = scorch_model
sm
n_layer = length(sm$scorch_architecture)/2
n_layer
2*(1:n_layer)
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_types
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types) == "layer"
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types == "layer")
layer_index
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types == "layer")
modules =
nn_module_list(
sm$scorch_architecture[layer_index]
)
modules
sm$scorch_architecture[layer_index]
which(layer_types == "layer")*2-1
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types == "layer")*2-1
modules =
nn_module_list(
sm$scorch_architecture[layer_index]
)
modules
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types == "layer")*2-1
func_index = which(layer_types == "function")*2-1
layer_index
func_index
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types == "layer")*2-1
func_index = which(layer_types == "function")*2-1
modules =
nn_module_list(
sm$scorch_architecture[layer_index]
)
self$modules = modules
sm$scorch_architecture[func_index]
load_all()
scorch_model = dl |>
initiate_scorch() |>
scorch_layer(nn_conv2d(1,32,3,1)) |>
scorch_layer(nn_relu())|>
scorch_layer(nn_conv2d(32,64,3,1)) |>
scorch_layer(nn_relu()) |>
scorch_layer(nn_max_pool2d(2)) |>
scorch_layer(nn_dropout2d(0.25)) |>
scorch_function(torch_flatten,start_dim=2) |>
scorch_layer(nn_linear(9216,128))
scorch_model |> compile_scorch()
args(fit_scorch)
scorch_model |> compile_scorch() |> fit_scorch(loss=nn_cross_entropy_loss,loss_params=list(),optim = optim_adam,num_epochs=3)
scorch_model |> compile_scorch()
tmp = scorch_model |> compile_scorch()
tmp$forward
names(tmp)
tmp$nn_model$forward(head(dl$input  ))
tmp$nn_model$forward(head(dl$input))
tmp$nn_model$forward(head(dl)$input)
scorch_model = dl |>
initiate_scorch() |>
scorch_layer(nn_conv2d(1,32,3,1)) |>
scorch_layer(nn_relu())
tmp = scorch_model |> compile_scorch()
tmp$nn_model$forward(head(dl)$input)
class(head(dl)$input)
head(dl)$input
head(dl)$input[1,,]
train_dl <- dataloader(train_ds, batch_size = 128, shuffle = TRUE)
train_dl$.iter()$.next()
names(train_dl$.iter()$.next())
train_dl$.iter()$.next()$x
dim(train_dl$.iter()$.next()$x)
dim(train_dl$.iter()$.next()$y)
?conv2d
?nn_conv2d
?torch_unsqueeze
x = torch_tensor(c(1, 2, 3, 4))
x
dim(x)
torch_unsqueeze(x, 2)
dim(torch_unsqueeze(x, 2))
head(dl)$input
torch_unsqueeze(head(dl)$input,2)
dim(head(dl)$input)
torch_unsqueeze(head(dl)$input,2)
dl = create_dataloader(train_ds$data |>
torch_tensor() |>
torch_unsqueeze(2),
train_ds$targets |>
torch_tensor())
dl
tmp$nn_model$forward(head(dl)$input)
torch_get_default_dtype()
?torch_tensor
dl = create_dataloader(train_ds$data |>
torch_tensor(dtype=torch_float()) |>
torch_unsqueeze(2),
train_ds$targets |>
torch_tensor())
tmp$nn_model$forward(head(dl)$input)
scorch_model = dl |>
initiate_scorch() |>
scorch_layer(nn_conv2d(1,32,3,1)) |>
scorch_layer(nn_relu())
tmp = scorch_model |> compile_scorch()
tmp
tmp$nn_model$forward(head(dl)$input)
tmp$nn_model$forward(head(dl)$input[1])
tmp$nn_model
tmp$nn_model$forward
sm
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_types
layer_index = which(layer_types == "layer")*2-1
func_index = which(layer_types == "function")*2-1
layer_index
modules =
nn_module_list(
sm$scorch_architecture[layer_index]
)
modules
func_index
sm$scorch_architecture[func_index]
n_layer = length(sm$scorch_architecture)/2
n_layer
length(sm$scorch_architecture)
sm$scorch_architecture
sm = dl |>
initiate_scorch() |>
scorch_layer(nn_conv2d(1,32,3,1)) |>
scorch_layer(nn_relu())
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types == "layer")*2-1
func_index = which(layer_types == "function")*2-1
n_layer
func_index
layer_index
modules =
nn_module_list(
sm$scorch_architecture[layer_index]
)
modules
sm$scorch_architecture[func_index]
n_layer = length(sm$scorch_architecture)/2
n_layer
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types == "layer")
layer_index
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types == "layer")*2-1
func_index = which(layer_types == "function")*2-1
layer_index
func_index
load_all()
scorch_model = dl |>
initiate_scorch() |>
scorch_layer(nn_conv2d(1,32,3,1)) |>
scorch_layer(nn_relu()) |> compile_scorch()
scorch_model
scorch_model$nn_model$forward(head(dl)$input)
sm = dl |>
initiate_scorch() |>
scorch_layer(nn_conv2d(1,32,3,1)) |>
scorch_layer(nn_relu())
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types == "layer")*2-1
func_index = which(layer_types == "function")*2-1
modules =
nn_module_list(
sm$scorch_architecture[layer_index]
)
self$modules = modules
self = list()
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types == "layer")*2-1
func_index = which(layer_types == "function")*2-1
modules =
nn_module_list(
sm$scorch_architecture[layer_index]
)
self$modules = modules
self$functions = sm$scorch_architecture[func_index]
self$modules
self$list
self$functions
layer_index
sm
length(sm$scorch_architecture)
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_types
scorch_model$scorch_architecture[2*(1:n_layer)]
scorch_model$scorch_architecture
n_layer = length(sm$scorch_architecture)/2
layer_types = sm$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types == "layer")*2-1
func_index = which(layer_types == "function")*2-1
sm
layer_index
self = list()
modules =
nn_module_list(
sm$scorch_architecture[layer_index]
)
self$modules = modules
self$functions = sm$scorch_architecture[func_index]
self
self$modules[[1]]
self$modules[[2]]
n_layer = length(sm$scorch_architecture)/2
layer_types = scorch_model$scorch_architecture[2*(1:n_layer)] |> unlist()
layer_index = which(layer_types == "layer")
output = input
i_layer
i_layer = i_function = 1
i_layer
load_all()
sm_comp = sm |> compile_scorch()
sm_comp
sm_comp$nn_model$forward(head(dl)$input)
layer_index
load_all()
sm_comp = sm |> compile_scorch()
sm_comp$nn_model$forward(head(dl)$input)
sm_comp$nn_model$forward(head(dl)$input)[2,,,]
sm_comp$nn_model$forward(head(dl)$input)[3,,,]
sm_comp$nn_model$forward(head(dl)$input)[4,,,]
sm
length(sm)
scorch_model = dl |>
initiate_scorch() |>
scorch_layer(nn_conv2d(1,32,3,1)) |>
scorch_layer(nn_relu())|>
scorch_layer(nn_conv2d(32,64,3,1)) |>
scorch_layer(nn_relu()) |>
scorch_layer(nn_max_pool2d(2)) |>
scorch_layer(nn_dropout2d(0.25)) |>
scorch_function(torch_flatten,start_dim=2) |>
scorch_layer(nn_linear(9216,128)) |>
scorch_layer(nn_relu()) |>
scorch_layer(nn_dropout2d(0.5)) |>
scorch_layer(nn_linear(128,10))
sm = scorch_model
sm_comp = sm |> compile_scorch()
sm_comp
sm_comp$nn_model$forward(head(dl)$input)
scorch_model = dl |>
initiate_scorch() |>
scorch_layer(nn_conv2d(1,32,3,1)) |>
scorch_layer(nn_relu())|>
scorch_layer(nn_conv2d(32,64,3,1)) |>
scorch_layer(nn_relu()) |>
scorch_layer(nn_max_pool2d(2)) |>
scorch_layer(nn_dropout2d(0.25)) |>
scorch_function(torch_flatten,start_dim=2) |>
scorch_layer(nn_linear(9216,128)) |>
scorch_layer(nn_relu()) |>
scorch_layer(nn_dropout(0.5)) |>
scorch_layer(nn_linear(128,10))
sm_comp = scorch_model |> compile_scorch()
sm_comp$nn_model$forward(head(dl)$input)[4,,,]
sm_comp$nn_model$forward(head(dl)$input)
compiled_scorch_model |>
fit_scorch(loss=nn_cross_entropy_loss,epochs=3)
?fit_scorch
compiled_scorch_model |>
fit_scorch(loss=nn_cross_entropy_loss,num_epochs=3)
loss_fn = nn_cross_entropy_loss
loss_params = list()
loss_fn = do.call(loss,loss_params)
loss = nn_cross_entropy_loss
loss_fn = do.call(loss,loss_params)
loss_fn
optim = adam_optim
optim_params = list(lr=0.001)
optim_params = append(list(params = compiled_scorch_model$nn_model$parameters),
optim_params)
compiled_scorch_model$nn_model$parameters
compiled_scorch_model$nn_model$parameters
compiled_scorch_model$nn_model
compiled_scorch_model
compiled_scorch_model
sm_comp = sm |> compile_scorch()
sm_comp
sm_comp$nn_model$parameters
optim_params = append(list(params = sm_comp$nn_model$parameters),
optim_params)
optim_params
optim_fn = do.call(optim,optim_params)
optim_params
?optim_adam
optim
optim = optim_adam
optim
optim_fn = do.call(optim,optim_params)
optim_fn
length_dl = length(sm_compl$dl)
length_dl = length(sm_comp$dl)
length_dl
sm_comp$dl
epoch = 1
total_loss  = 0
batch in scorch_model$dl
coro::loop(for (batch in scorch_model$dl) {
optim_fn$zero_grad()
pred = scorch_model$nn_model(batch$input)
loss = loss_fn(pred, batch$output)
loss$backward()
optim_fn$step()
total_loss = total_loss + loss$item()
})
coro::loop(for (batch in sm_comp$dl) {
optim_fn$zero_grad()
pred = sm_comp$nn_model(batch$input)
loss = loss_fn(pred, batch$output)
loss$backward()
optim_fn$step()
total_loss = total_loss + loss$item()
})
warnings()
?fit_scorch
ss_comp |> fit_scorch(loss=nn_cross_entropy_loss,loss_params=list(),num_epochs=2)
sm_comp |> fit_scorch(loss=nn_cross_entropy_loss,loss_params=list(),num_epochs=2)
library(scorcher)
library(torch)
library(torchvision)
scorch_model = dl |>
initiate_scorch() |>
scorch_layer(nn_conv2d(1,32,3,1)) |>
scorch_layer(nn_relu())|>
scorch_layer(nn_conv2d(32,64,3,1)) |>
scorch_layer(nn_relu()) |>
scorch_layer(nn_max_pool2d(2)) |>
scorch_layer(nn_dropout2d(0.25)) |>
scorch_function(torch_flatten,start_dim=2) |>
scorch_layer(nn_linear(9216,128)) |>
scorch_layer(nn_relu()) |>
scorch_layer(nn_linear(128,10))
compiled_scorch_model = scorch_model |>
compile_scorch()
fitted_scorch_model = compiled_scorch_model |>
fit_scorch(loss=nn_cross_entropy_loss,num_epochs=3)
fitted_scorch_model(head(dl)$input)
head(dl)$targets
head(dl)$output
dl = create_dataloader(train_ds$data |>
torch_tensor(dtype=torch_float()) |>
torch_unsqueeze(2),
train_ds$targets |>
torch_tensor(),
batch_size = 500)
scorch_model = dl |>
initiate_scorch() |>
scorch_layer(nn_conv2d(1,32,3,1)) |>
scorch_layer(nn_relu())|>
scorch_layer(nn_conv2d(32,64,3,1)) |>
scorch_layer(nn_relu()) |>
scorch_layer(nn_max_pool2d(2)) |>
scorch_layer(nn_dropout2d(0.25)) |>
scorch_function(torch_flatten,start_dim=2) |>
scorch_layer(nn_linear(9216,128)) |>
scorch_layer(nn_relu()) |>
scorch_layer(nn_linear(128,10))
compiled_scorch_model = scorch_model |>
compile_scorch()
fitted_scorch_model = compiled_scorch_model |>
fit_scorch(loss=nn_cross_entropy_loss,num_epochs=3)
pred = fitted_scorch_model(head(dl)$input)
pred[1,]
dim(pred)
dl
head(dl)$output
length(head(dl)$output)
dim(head(dl)$input)
dl
dim(head(dl)$input,10)
?head
pred = fitted_scorch_model(head(dl,n=500)$input)
true = head(dl,n=500)$output
true
pred
which.max(pred[1,])
pred = fitted_scorch_model(head(dl,n=500)$input) |> as.matrix()
dim(pred)
which.max(pred[1,])
true[1]
true[1:10]
which.max(pred[2,])
which.max(pred[3,])
which.max(pred[4,])
apply(pred,1,which.max)
pred = apply(pred,1,which.max)
table(pred,true)
length(true)
length(pred)
table(pred,true)
length(unique(true))
length(true)
true
table(pred,true |> as.vector())
table(pred,true |> as_array())
fitted_scorch_model = compiled_scorch_model |>
fit_scorch(loss=nn_cross_entropy_loss,num_epochs=10)
pred = fitted_scorch_model(head(dl,n=500)$input) |> as.matrix()
pred = apply(fitted_scorch_model(head(dl,n=500)$input) |> as.matrix(),1,which.max)
rm(true)
truth = head(dl,n=500)$output |> as.vector()
head(dl,n=500)$output
head(dl,n=500)$output |> as.vector()
head(dl,n=500)$output |> as_array()
truth = head(dl,n=500)$output |> as_array()
pred
table(pred,truth)
plot(truth, predicted)
plot(truth, pred)
nn_cross_entropy_loss()
truth = head(dl,n=500)$output
pred = fitted_scorch_model(head(dl,n=500)$input)
nn_cross_entropy_loss(truth,pred)
nn_cross_entropy_loss(pred,truth)
nn_cross_entropy_loss()
nn_cross_entropy_loss()(pred,truth)
nn_cross_entropy_loss()(truth,pred)
nn_cross_entropy_loss()(pred,truth)
